<?xml version="1.0" ?>
<extension name="graphviz" version="1.0.0">

 <deps lang="c">

  <with name="graphviz" pkgconfig="libgvc" version="2.8">
    <header name="gvc.h"/>
  </with>

  <with name="zlib" testfile="include/zlib.h">
    <lib name="z"/>
  </with>

 </deps>

 <resource name="graphviz_context" payload="GVC_t" alloc="no">
  <destruct>
   if (resource) {
	 gvFreeContext(resource);
   }
  </destruct>
 </resource>

 <function name="graphviz_new_context">
  <proto>resource graphviz_context gvContext([array args])</proto>
  <code>
<?data
    int argc, n;
    char **argv;
	zval **tmp;
	HashPosition pos;

    if (!(return_res = gvContext())) RETURN_FALSE;

    argc = zend_hash_num_elements(args_hash);
	if (argc > 0) {
      argv = (char **)calloc(sizeof(char *), argc);
      zend_hash_internal_pointer_reset_ex(args_hash, &pos);
	  n = 0;
      while (zend_hash_get_current_data_ex(args_hash, (void **) &tmp, &pos) == SUCCESS) {
        SEPARATE_ZVAL(tmp);
        convert_to_string(*tmp);

		argv[n++] = strndup(Z_STRVAL_PP(tmp), Z_STRLEN_PP(tmp));
      }
       
      gvParseArgs(return_res, argc, argv);

	  for (n = 0; n < argc; n++) {
		free(argv[n]);
      }
	  free(argv);
    }	
?>
  </code>
 </function>

 <function name="graphviz_free_context">
  <proto>void gvFreeContext(resource graphviz_context context)</proto>
  <code>
    FREE_RESOURCE(context);
  </code>
 </function>

 
 <resource name="graphviz_graph" payload="Agraph_t" alloc="no">
  <destruct>if (resource) agclose(resource);</destruct>
 </resource>


 <constant name="GRAPHVIZ_UNDIRECTED" type="int" value="0"/>
 <constant name="GRAPHVIZ_DIRECTED"   type="int" value="AGFLAG_DIRECTED"/>


 <function name="graphviz_new_graph">
  <proto>resource graphviz_graph graphviz_new_graph(string name, int kind)</proto>
  <code>if (!(return_res = agopen(name, kind))) RETURN_FALSE;</code>
 </function>

 <function name="graphviz_free_graph">
  <proto>void graphviz_free_graph(resource graphviz_graph graph)</proto>
  <code>
   FREE_RESOURCE(graph);
  </code>
 </function>


</extension>
